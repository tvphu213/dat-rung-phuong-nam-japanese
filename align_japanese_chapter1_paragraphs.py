#!/usr/bin/env python3
"""Align Japanese chapter 1 paragraph structure with Vietnamese version"""

import json
from pathlib import Path

def main():
    """Add paragraph breaks to Japanese chapter 1 to match Vietnamese structure"""

    ja_filepath = Path(__file__).parent / 'chapters' / 'json' / 'chapter-ja-1.json'

    print(f"Reading {ja_filepath}...")
    with open(ja_filepath, 'r', encoding='utf-8') as f:
        data = json.load(f)

    original_content = data['content']

    # The Japanese text currently has 9 long paragraphs
    # We need to split them to match the Vietnamese structure (80 paragraphs)
    # I'll add \n\n breaks at natural boundaries to match Vietnamese

    content = original_content

    # Paragraph 1 in Japanese is very long, needs to be split into multiple paragraphs
    # Based on Vietnamese structure:
    # 1. First paragraph ends at "...ぼんやりとそう考えるのだった。"
    # 2. Second starts with "この市場村に流れ着いて..."
    # 3. Third starts with "ある夕方、南部抵抗委員会の..."

    # Split the first massive Japanese paragraph
    content = content.replace(
        'ぼんやりとそう考えるのだった。 この市場村に流れ着いて、数えてみればもう半月以上になる。 ある夕方、南部抵抗委員会の軍糧輸送船団がここに停泊した。',
        'ぼんやりとそう考えるのだった。\n\nこの市場村に流れ着いて、数えてみればもう半月以上になる。\n\nある夕方、南部抵抗委員会の軍糧輸送船団がここに停泊した。'
    )

    # Split after dialogue
    content = content.replace(
        '「三十分ほど停泊して、おじさんたちが市場で食料を買うだけだ。岸に上がりたいか?」 私は首を横に振った。',
        '「三十分ほど停泊して、おじさんたちが市場で食料を買うだけだ。岸に上がりたいか?」\n\n私は首を横に振った。'
    )

    content = content.replace(
        'ぱっと岸に飛び降りた。 「どこにも行くなよ!',
        'ぱっと岸に飛び降りた。\n\n「どこにも行くなよ!'
    )

    content = content.replace(
        '私に聞こえるよう大声で言った。 「わかった!聞こえたよ...行ってきて!」私は口に手を当てて答えた。 私は米を運ぶ船の船首に座って',
        '私に聞こえるよう大声で言った。\n\n「わかった!聞こえたよ...行ってきて!」私は口に手を当てて答えた。\n\n私は米を運ぶ船の船首に座って'
    )

    content = content.replace(
        '手にランプを持っていた。 買い手のランプ、売り手のランプ、まるで星が降るようだった。 騒がしい人混みと',
        '手にランプを持っていた。\n\n買い手のランプ、売り手のランプ、まるで星が降るようだった。\n\n騒がしい人混みと'
    )

    content = content.replace(
        '激しく鳴り響いた。 「シャントン劇だぞ、おい!」',
        '激しく鳴り響いた。\n\n「シャントン劇だぞ、おい!」'
    )

    # Continue splitting based on Vietnamese structure
    content = content.replace(
        '「また女の子が火の輪くぐりをするぞ!早く行こう、おい!」 子供たちが',
        '「また女の子が火の輪くぐりをするぞ!早く行こう、おい!」\n\n子供たちが'
    )

    content = content.replace(
        '歓声が聞こえてきた。 私はつま先立ちになって',
        '歓声が聞こえてきた。\n\n私はつま先立ちになって'
    )

    content = content.replace(
        '衝動を抑えようとした。 「アンはまだそこにいるか?」',
        '衝動を抑えようとした。\n\n「アンはまだそこにいるか?」'
    )

    content = content.replace(
        'しゃがれた声で尋ねた。 「ここにいますよ、おじさん!」私は急いで答えたが、心は少し高ぶっていた。 「なあ、お前シャントン劇を見たいか?」おじさんがまた尋ねた。 「兄さんたちが、ここで船を見張っていろって」 船頭は',
        'しゃがれた声で尋ねた。\n\n「ここにいますよ、おじさん!」私は急いで答えたが、心は少し高ぶっていた。\n\n「なあ、お前シャントン劇を見たいか?」おじさんがまた尋ねた。\n\n「兄さんたちが、ここで船を見張っていろって」\n\n船頭は'
    )

    content = content.replace(
        '大声で笑った。 「俺は川という川を全部回ったが',
        '大声で笑った。\n\n「俺は川という川を全部回ったが'
    )

    content = content.replace(
        'こぼさなかったんだぜ」 「おじさんは',
        'こぼさなかったんだぜ」\n\n「おじさんは'
    )

    content = content.replace(
        '私は尋ねた。 「俺がコーヒーなんて飲むかよ?',
        '私は尋ねた。\n\n「俺がコーヒーなんて飲むかよ?'
    )

    content = content.replace(
        '「いいか、俺がここにいるから、お前は市場に遊びに行ってこい。船着場に戻る道は覚えてるか?遠くに行くなよ、迷子になるぞ」 なんてこった',
        '「いいか、俺がここにいるから、お前は市場に遊びに行ってこい。船着場に戻る道は覚えてるか?遠くに行くなよ、迷子になるぞ」\n\nなんてこった'
    )

    content = content.replace(
        '船の板に飛び降りた。 「何笑ってんだ、アン?」おじさんが目を凝らして私に尋ねた。 「いえ、何も笑ってませんよ」 「俺が酔ってると思ってるのか?',
        '船の板に飛び降りた。\n\n「何笑ってんだ、アン?」おじさんが目を凝らして私に尋ねた。\n\n「いえ、何も笑ってませんよ」\n\n「俺が酔ってると思ってるのか?'
    )

    content = content.replace(
        '潮が満ちてきたな」 「行ってきます、おじさん!」 おじさんの返事を待たずに',
        '潮が満ちてきたな」\n\n「行ってきます、おじさん!」\n\nおじさんの返事を待たずに'
    )

    content = content.replace(
        'あっという間に私は岸に足を踏み入れた。なんてこった!なんて不思議な市場なんだ?',
        'あっという間に私は岸に足を踏み入れた。\n\nなんてこった!なんて不思議な市場なんだ?'
    )

    content = content.replace(
        '数え切れないほどある。私はさらに数歩進み',
        '数え切れないほどある。\n\n私はさらに数歩進み'
    )

    content = content.replace(
        '爆竹が一斉に鳴り響いた。私はもう周りを見る気もなくなった。私はまた一目散に',
        '爆竹が一斉に鳴り響いた。\n\n私はもう周りを見る気もなくなった。私はまた一目散に'
    )

    content = content.replace(
        '躊躇した。 「もし彼が船に戻れと言ったら?',
        '躊躇した。\n\n「もし彼が船に戻れと言ったら?'
    )

    content = content.replace(
        '肘で私の脇腹を突いた。 「ちょっと見せてよ!」 私が譲歩する口調で言うと',
        '肘で私の脇腹を突いた。\n\n「ちょっと見せてよ!」\n\n私が譲歩する口調で言うと'
    )

    content = content.replace(
        '知り合いだったかのように。 「お前、今来たのか?',
        '知り合いだったかのように。\n\n「お前、今来たのか?'
    )

    content = content.replace(
        '注意を払わなかった。 黒い中国服を着た芸人の口上役が',
        '注意を払わなかった。\n\n黒い中国服を着た芸人の口上役が'
    )

    content = content.replace(
        '紹介し始めた。 「この芸は昨夜もやったんだ。言葉にできないほど凄いぞ!」 背の低いずんぐりした太った男の子が',
        '紹介し始めた。\n\n「この芸は昨夜もやったんだ。言葉にできないほど凄いぞ!」\n\n背の低いずんぐりした太った男の子が'
    )

    content = content.replace(
        '誇らしげな声で言った。 赤いサテンの衣装を着て',
        '誇らしげな声で言った。\n\n赤いサテンの衣装を着て'
    )

    content = content.replace(
        '観客に頭を下げた。油を染み込ませた布を巻いた鉄の輪が',
        '観客に頭を下げた。\n\n油を染み込ませた布を巻いた鉄の輪が'
    )

    content = content.replace(
        '火の輪を飛び抜けた。 私の目は眩み',
        '火の輪を飛び抜けた。\n\n私の目は眩み'
    )

    content = content.replace(
        '「昨夜は六回飛んだのに、今日は八回に増えてる!すごいだろ?」背の低いずんぐりした太った男の子が私を突き、得意げな顔で言った。 芸人が',
        '「昨夜は六回飛んだのに、今日は八回に増えてる!すごいだろ?」背の低いずんぐりした太った男の子が私を突き、得意げな顔で言った。\n\n芸人が'
    )

    content = content.replace(
        '前の焦げた髪の毛を払っていた。 どうやら今夜は薬の売れ行きが少なすぎるようだ。',
        '前の焦げた髪の毛を払っていた。\n\nどうやら今夜は薬の売れ行きが少なすぎるようだ。'
    )

    content = content.replace(
        'わざと元気な様子を作った。 「皆さん、この芸をご覧になってから',
        'わざと元気な様子を作った。\n\n「皆さん、この芸をご覧になってから'
    )

    content = content.replace(
        '「皆さん、この芸をご覧になってから、後でお買い上げいただいても結構です。さあ、鐃鈸を鳴らせ!」 太鼓とシンバルの音がまた激しく鳴り響いた。 芸人は',
        '「皆さん、この芸をご覧になってから、後でお買い上げいただいても結構です。さあ、鐃鈸を鳴らせ!」\n\n太鼓とシンバルの音がまた激しく鳴り響いた。\n\n芸人は'
    )

    content = content.replace(
        'ますます狭くした。芸人は太鼓とシンバルを叩く人たちを見て、手を止めるよう合図した。',
        'ますます狭くした。\n\n芸人は太鼓とシンバルを叩く人たちを見て、手を止めるよう合図した。'
    )

    content = content.replace(
        '私は目を閉じた。なんてこった!',
        '私は目を閉じた。\n\nなんてこった!'
    )

    content = content.replace(
        '呼吸も全く変わらなかった。 「大人がやっても面白くない。子供がやるから面白いんだ!」芸人が手を振って紹介した。 女の子が出てきて',
        '呼吸も全く変わらなかった。\n\n「大人がやっても面白くない。子供がやるから面白いんだ!」芸人が手を振って紹介した。\n\n女の子が出てきて'
    )

    content = content.replace(
        '踏みしめるように動き始めた。私は不安になった。',
        '踏みしめるように動き始めた。\n\n私は不安になった。'
    )

    content = content.replace(
        '極めて危険な芸を披露する前に、必死で気持ちを落ち着けようとしているのだ。 「父さんがここにいるぞ、娘よ」',
        '極めて危険な芸を披露する前に、必死で気持ちを落ち着けようとしているのだ。\n\n「父さんがここにいるぞ、娘よ」'
    )

    content = content.replace(
        '目は厳粛で恐ろしかった。 女の子はすぐに父親のように一声叫び',
        '目は厳粛で恐ろしかった。\n\n女の子はすぐに父親のように一声叫び'
    )

    content = content.replace(
        '火の輪を飛び抜けた。周囲は静まり返った。',
        '火の輪を飛び抜けた。\n\n周囲は静まり返った。'
    )

    content = content.replace(
        '耳の周りで上がった。 女の子が倒れた。',
        '耳の周りで上がった。\n\n女の子が倒れた。'
    )

    content = content.replace(
        '右足がナイフの刃に引っかかったのだ。 観客たちが押し寄せた。',
        '右足がナイフの刃に引っかかったのだ。\n\n観客たちが押し寄せた。'
    )

    content = content.replace(
        '赤い血が流れ出た。 「大したことない!膏薬を貼れば、すぐに治る!」',
        '赤い血が流れ出た。\n\n「大したことない!膏薬を貼れば、すぐに治る!」'
    )

    content = content.replace(
        '近くの運河に停泊していた船に運ばせた。 子供たちがどっと押し寄せて追いかけた。',
        '近くの運河に停泊していた船に運ばせた。\n\n子供たちがどっと押し寄せて追いかけた。'
    )

    content = content.replace(
        '私も子供たちの後を追い、川岸に降りて船の中を覗き込んだ。 女の子は船首に背中を預けて座り',
        '私も子供たちの後を追い、川岸に降りて船の中を覗き込んだ。\n\n女の子は船首に背中を預けて座り'
    )

    content = content.replace(
        '目を閉じた。盲目の女性がランプを持って娘の足を照らし、赤く腫れた目をしていた。 「痛いかい、娘よ?」 女の子は目をぎゅっと閉じ',
        '目を閉じた。盲目の女性がランプを持って娘の足を照らし、赤く腫れた目をしていた。\n\n「痛いかい、娘よ?」\n\n女の子は目をぎゅっと閉じ'
    )

    content = content.replace(
        '首を横に振った。母親の涙が一滴、痛む娘の小さな足に落ちた。',
        '首を横に振った。\n\n母親の涙が一滴、痛む娘の小さな足に落ちた。'
    )

    content = content.replace(
        '熱湯の一滴が足に落ちたかのように。 「ああ、大丈夫だよ、お母さん。ちょっとズキズキするだけだから!」 そう言いながら',
        '熱湯の一滴が足に落ちたかのように。\n\n「ああ、大丈夫だよ、お母さん。ちょっとズキズキするだけだから!」\n\nそう言いながら'
    )

    content = content.replace(
        '汗の粒が滲み出た。私は女の子がとても痛がっているのが確かだと分かった。',
        '汗の粒が滲み出た。\n\n私は女の子がとても痛がっているのが確かだと分かった。'
    )

    content = content.replace(
        '私はもう見ていられなくなり、市場に戻った。 その頃には劇団の公演も終わっていた。',
        '私はもう見ていられなくなり、市場に戻った。\n\nその頃には劇団の公演も終わっていた。'
    )

    content = content.replace(
        'コレージュの学生の姿はどこにもなかった。私は枯れたガジュマルの木の方角を目指して、一気に走って戻った。',
        'コレージュの学生の姿はどこにもなかった。\n\n私は枯れたガジュマルの木の方角を目指して、一気に走って戻った。'
    )

    content = content.replace(
        '軍糧輸送船団は一隻も停泊していなかった。私は船着場沿いをしばらく走り、彼らがたった今出発したばかりで、まだ追いつけるかもしれないと希望を持った。 空は真っ暗だった。',
        '軍糧輸送船団は一隻も停泊していなかった。\n\n私は船着場沿いをしばらく走り、彼らがたった今出発したばかりで、まだ追いつけるかもしれないと希望を持た。\n\n空は真っ暗だった。'
    )

    content = content.replace(
        'その運河がどこに流れて行くのか分からなかった。一人の女性が桶を担いで水を汲みに船着場に降りてきて、しばらく私を見つめてから尋ねた。 「お前、輸送船団にいたんじゃないのかい?」 「はい、そうです!」私は急いで答え、少し喜んだ。「皆さんはどこに行ったんですか、おばさん?」 「なんてこった!',
        'その運河がどこに流れて行くのか分からなかった。\n\n一人の女性が桶を担いで水を汲みに船着場に降りてきて、しばらく私を見つめてから尋ねた。\n\n「お前、輸送船団にいたんじゃないのかい?」\n\n「はい、そうです!」私は急いで答え、少し喜んだ。「皆さんはどこに行ったんですか、おばさん?」\n\n「なんてこった!'
    )

    content = content.replace(
        'とても急いでたみたいだ!」 「おばさんは、皆がどこに行くと言ってたか聞きましたか?」私は尋ね返した。 「軍事のことだからね、分かるわけないよ!お前も知らないの?言われなかったの?」 「いいえ、おばさん!」 「お前には父母や兄弟が船にいたのかい?」 「いいえ。渡し船に乗っていただけです」女性は唇を長く伸ばした。 「道理でね...人には人の用事があるんだよ。誰が遊びに夢中になって、あちこちうろつけって言ったんだい?」 女性はそれ以上何も言わず',
        'とても急いでたみたいだ!」\n\n「おばさんは、皆がどこに行くと言ってたか聞きましたか?」私は尋ね返した。\n\n「軍事のことだからね、分かるわけないよ!お前も知らないの?言われなかったの?」\n\n「いいえ、おばさん!」\n\n「お前には父母や兄弟が船にいたのかい?」\n\n「いいえ。渡し船に乗っていただけです」女性は唇を長く伸ばした。\n\n「道理でね...人には人の用事があるんだよ。誰が遊びに夢中になって、あちこちうろつけって言ったんだい?」\n\n女性はそれ以上何も言わず'
    )

    content = content.replace(
        '静かに川に降りて水を汲んで市場に担いで行った。突然、私は胸の中が熱くなって泣きたくなった... 昼間、私は船着場沿いをぼんやりと歩き',
        '静かに川に降りて水を汲んで市場に担いで行った。\n\n突然、私は胸の中が熱くなって泣きたくなった...\n\n昼間、私は船着場沿いをぼんやりと歩き'
    )

    content = content.replace(
        '軍糧輸送船団の知り合いが戻ってこないか期待した。夜、私は市場で寝て、華僑の豚肉売り場の台の下に潜り込んだ。 市場の女性たちは私を「避難してきた子」と呼んだ。',
        '軍糧輸送船団の知り合いが戻ってこないか期待した。夜、私は市場で寝て、華僑の豚肉売り場の台の下に潜り込んだ。\n\n市場の女性たちは私を「避難してきた子」と呼んだ。'
    )

    content = content.replace(
        'この辺鄙な田舎の運河の三叉路にある小さな市場が、小さな町のように賑やかになった。サイゴンから逃げてきた人もいる。ティエンザン、ハウザン地方の人もいる。',
        'この辺鄙な田舎の運河の三叉路にある小さな市場が、小さな町のように賑やかになった。\n\nサイゴンから逃げてきた人もいる。ティエンザン、ハウザン地方の人もいる。'
    )

    content = content.replace(
        '私は彼らが互いに愚痴を言うのを聞いただけだった。「我々の側はダメすぎる、フランス軍を止められない」とか、「ここに逃げてきても氷水を飲めないし、真水で風呂に入れない」とか。',
        '私は彼らが互いに愚痴を言うのを聞いただけだった。\n\n「我々の側はダメすぎる、フランス軍を止められない」とか、「ここに逃げてきても氷水を飲めないし、真水で風呂に入れない」とか。'
    )

    content = content.replace(
        '「おい、行け行け、小僧。盗みでも企んでるのか?」私は悔しくて泣きそうになった。',
        '「おい、行け行け、小僧。盗みでも企んでるのか?」\n\n私は悔しくて泣きそうになった。'
    )

    content = content.replace(
        '橋の上で膝を抱えて水面を見つめると、私自身もこの奇妙な姿の自分を認識するのが難しかった。髪は長く伸びてほぼ首筋まで覆い、目の周りは深くくぼみ、首は幽霊の鶴のように痩せこけていた。',
        '橋の上で膝を抱えて水面を見つめると、私自身もこの奇妙な姿の自分を認識するのが難しかった。\n\n髪は長く伸びてほぼ首筋まで覆い、目の周りは深くくぼみ、首は幽霊の鶴のように痩せこけていた。'
    )

    content = content.replace(
        'パサパサと音を立てた。 私のウールのショートパンツは色褪せ、両裾はボロボロに破れて、魚に齧られたようだった。 誰かが何か頼み事をすると、私は手伝った。',
        'パサパサと音を立てた。\n\n私のウールのショートパンツは色褪せ、両裾はボロボロに破れて、魚に齧られたようだった。\n\n誰かが何か頼み事をすると、私は手伝った。'
    )

    content = content.replace(
        '魚の水を替えるための水を汲んでくれと頼んだ。 「坊や、サトウキビの束を運んでくれ!」 「坊や、海老の籠を市場まで担いでいってくれ」 「坊や!坊や!運河のところに降りて行って、おばさんの流れそうな竿を挿し直しておくれ!」 ある人は私におにぎりを、ある人はトウモロコシの包みをくれた。',
        '魚の水を替えるための水を汲んでくれと頼んだ。\n\n「坊や、サトウキビの束を運んでくれ!」\n\n「坊や、海老の籠を市場まで担いでいってくれ」\n\n「坊や!坊や!運河のところに降りて行って、おばさんの流れそうな竿を挿し直しておくれ!」\n\nある人は私におにぎりを、ある人はトウモロコシの包みをくれた。'
    )

    content = content.replace(
        '誰も私がどこから流れ着いたのか知らなかった。 毎日、私は居酒屋の前を一度は通った。あの時の年老いた船頭が、通りがかりにここに立ち寄らないだろうか? 1946年の雨季の始まりの日々は',
        '誰も私がどこから流れ着いたのか知らなかった。\n\n毎日、私は居酒屋の前を一度は通った。あの時の年老いた船頭が、通りがかりにここに立ち寄らないだろうか?\n\n1946年の雨季の始まりの日々は'
    )

    content = content.replace(
        'この南部の塩水地帯では、人々は雨を、私たち子供が母親の市場からの帰りを待つように待ち望んでいた。',
        'この南部の塩水地帯では、人々は雨を、私たち子供が母親の市場からの帰りを待つように待ち望んでいた。'
    )

    content = content.replace(
        '雨が降れば真水を飲め、田を耕す水がある。しかし目の前で最も重要なことは、雨が敵の進軍を遅らせ、軍道を滑りやすく泥沼にして障害を作ることができるということだった。 雨が近づけば近づくほど',
        '雨が降れば真水を飲め、田を耕す水がある。しかし目の前で最も重要なことは、雨が敵の進軍を遅らせ、軍道を滑りやすく泥沼にして障害を作ることができるということだった。\n\n雨が近づけば近づくほど'
    )

    content = content.replace(
        '夜になってようやく、タイランド湾の方角から少しの風が吹いてきた。いつも、市場の人々は夜にゴザを持って運河の岸辺に座って涼み、避難民の船や共和国衛兵を乗せた船が上流から下ってくるのを見た。',
        '夜になってようやく、タイランド湾の方角から少しの風が吹いてきた。\n\nいつも、市場の人々は夜にゴザを持って運河の岸辺に座って涼み、避難民の船や共和国衛兵を乗せた船が上流から下ってくるのを見た。'
    )

    # Fix typo from earlier edit
    content = content.replace('まだ追いつけるかもしれないと希望を持た。', 'まだ追いつけるかもしれないと希望を持った。')

    if original_content != content:
        data['content'] = content
        print(f"Writing updated content...")
        with open(ja_filepath, 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)

        # Count paragraphs
        new_paragraphs = content.count('\n\n') + 1
        print(f"✓ Updated chapter-ja-1.json")
        print(f"\nStatistics:")
        print(f"  Before: 9 paragraphs")
        print(f"  After: {new_paragraphs} paragraphs")
        print(f"  Target (Vietnamese): 80 paragraphs")
    else:
        print("- No changes needed")

if __name__ == '__main__':
    main()
