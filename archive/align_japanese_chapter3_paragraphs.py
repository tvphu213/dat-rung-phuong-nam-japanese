#!/usr/bin/env python3
"""Align Japanese chapter 3 paragraph structure - add natural breaks for Japanese writing style"""

import json
from pathlib import Path

def align_japanese_paragraphs(content):
    """Add natural paragraph breaks to Japanese chapter 3"""

    # SECTION 1: Meeting at the market
    content = content.replace(
        '数日後、私は再び蛇売りの老人に会った。今度は市場でだった。 老人は大きな竹籠を地面に置き、',
        '数日後、私は再び蛇売りの老人に会った。今度は市場でだった。\n\n老人は大きな竹籠を地面に置き、'
    )

    content = content.replace(
        '周りに人々を集めていた。籠の中には、様々な色の蛇がとぐろを巻いていた。緑色の蛇、茶色の蛇、そして黒い斑点のある黄色い蛇。それらは静かに横たわっていたが、時々舌をチロチロと出していた。 「さあさあ、皆さん!」老人が声を上げた。',
        '周りに人々を集めていた。籠の中には、様々な色の蛇がとぐろを巻いていた。緑色の蛇、茶色の蛇、そして黒い斑点のある黄色い蛇。それらは静かに横たわっていたが、時々舌をチロチロと出していた。\n\n「さあさあ、皆さん!」老人が声を上げた。'
    )

    content = content.replace(
        '「これらの蛇から作った薬は、あらゆる病を治します!関節痛、頭痛、腹痛...何でも効きますよ!」 人々は興味津々で籠を覗き込んでいたが、',
        '「これらの蛇から作った薬は、あらゆる病を治します!関節痛、頭痛、腹痛...何でも効きますよ!」\n\n人々は興味津々で籠を覗き込んでいたが、'
    )

    content = content.replace(
        '誰も近づこうとはしなかった。蛇は美しいが危険だった。 老人は籠から一匹の緑色の蛇を取り出した。',
        '誰も近づこうとはしなかった。蛇は美しいが危険だった。\n\n老人は籠から一匹の緑色の蛇を取り出した。'
    )

    content = content.replace(
        'その蛇は老人の手に巻きついたが、老人は全く恐れていないようだった。彼は蛇を高く掲げ、日光に照らされた鱗がキラキラと輝くのを見せた。 「この青竹蛇は、深い森の奥でしか見つかりません。',
        'その蛇は老人の手に巻きついたが、老人は全く恐れていないようだった。彼は蛇を高く掲げ、日光に照らされた鱗がキラキラと輝くのを見せた。\n\n「この青竹蛇は、深い森の奥でしか見つかりません。'
    )

    content = content.replace(
        'その毒は強力ですが、正しく処理すれば、最高の薬になるのです」 私は人混みの後ろから、fascinated に見ていた。',
        'その毒は強力ですが、正しく処理すれば、最高の薬になるのです」\n\n私は人混みの後ろから、fascinated に見ていた。'
    )

    content = content.replace(
        '老人の手の動きは優雅で、まるで蛇と踊っているようだった。 突然、老人が私を見つけた。 「おや、避難してきた坊やじゃないか!こっちに来なさい、来なさい!」 人々が道を開け、',
        '老人の手の動きは優雅で、まるで蛇と踊っているようだった。\n\n突然、老人が私を見つけた。\n\n「おや、避難してきた坊やじゃないか!こっちに来なさい、来なさい!」\n\n人々が道を開け、'
    )

    # SECTION 2: Showing the snake to the boy
    content = content.replace(
        '私は老人の前に進み出た。\n\n「この子に見せてやりましょう」老人が言った。',
        '私は老人の前に進み出た。\n\n「この子に見せてやりましょう」\n\n老人が言った。'
    )

    content = content.replace(
        '「怖がらなくていいんだよ。蛇は人を傷つけようとしているわけじゃない。彼らも生きているだけなんだ」 老人は蛇を私に差し出した。',
        '「怖がらなくていいんだよ。蛇は人を傷つけようとしているわけじゃない。彼らも生きているだけなんだ」\n\n老人は蛇を私に差し出した。'
    )

    content = content.replace(
        '私は躊躇したが、老人の優しい目を見て、勇気を出して手を伸ばした。蛇の肌は予想していたよりも滑らかで冷たかった。それは私の腕に軽く巻きつき、私の体温を感じているようだった。 「ほら、怖くないだろう?」老人が微笑んだ。 人々は拍手をし、',
        '私は躊躇したが、老人の優しい目を見て、勇気を出して手を伸ばした。蛇の肌は予想していたよりも滑らかで冷たかった。それは私の腕に軽く巻きつき、私の体温を感じているようだった。\n\n「ほら、怖くないだろう?」老人が微笑んだ。\n\n人々は拍手をし、'
    )

    content = content.replace(
        '何人かは老人から薬を買い始めた。老人は丁寧に各客に薬の使い方を説明し、小さな瓶に入れた液体を手渡していた。 市場が閑散になった午後、老人は私に声をかけた。 「坊や、一緒に来ないか?お前に見せたいものがある」 私はトゥ・ベオおばさんに許可をもらい、',
        '何人かは老人から薬を買い始めた。老人は丁寧に各客に薬の使い方を説明し、小さな瓶に入れた液体を手渡していた。\n\n市場が閑散になった午後、老人は私に声をかけた。\n\n「坊や、一緒に来ないか?お前に見せたいものがある」\n\n私はトゥ・ベオおばさんに許可をもらい、'
    )

    # SECTION 3: Walking to the pond
    content = content.replace(
        '老人について行った。私たちは市場を離れ、田んぼの間の細い道を歩いた。太陽は西に傾き始め、空は金色とオレンジ色に染まっていた。 「お前は父親を探していると言ったね」老人が歩きながら言った。 「はい」私は答えた。',
        '老人について行った。私たちは市場を離れ、田んぼの間の細い道を歩いた。太陽は西に傾き始め、空は金色とオレンジ色に染まっていた。\n\n「お前は父親を探していると言ったね」老人が歩きながら言った。\n\n「はい」私は答えた。'
    )

    content = content.replace(
        '「父は南の方にいると聞きました。でも、どこにいるのか正確には分かりません」 「南は広い」老人が言った。',
        '「父は南の方にいると聞きました。でも、どこにいるのか正確には分かりません」\n\n「南は広い」老人が言った。'
    )

    content = content.replace(
        '「多くの村、多くの町がある。だが、心配するな。探し続ければ、きっと見つかる。大切なのは、希望を失わないことだ」\n\n私たちは小さな池の近くで止まった。',
        '「多くの村、多くの町がある。だが、心配するな。探し続ければ、きっと見つかる。大切なのは、希望を失わないことだ」\n\n私たちは小さな池の近くで止まった。'
    )

    # SECTION 4: At the pond
    content = content.replace(
        '池の周りには背の高い草が生え、水面には蓮の葉が浮かんでいた。老人は池の縁に座り、私も隣に座った。 「ここで、私はよく蛇を捕まえるんだ」老人が言った。',
        '池の周りには背の高い草が生え、水面には蓮の葉が浮かんでいた。老人は池の縁に座り、私も隣に座った。\n\n「ここで、私はよく蛇を捕まえるんだ」老人が言った。'
    )

    content = content.replace(
        '「蛇は水辺が好きなんだよ。夕方になると、彼らは出てきて獵をする」 私たちはしばらく静かに座っていた。',
        '「蛇は水辺が好きなんだよ。夕方になると、彼らは出てきて獵をする」\n\n私たちはしばらく静かに座っていた。'
    )

    content = content.replace(
        '風が草を揺らし、池の水が小さな波を立てた。どこかで鳥が鳴いていた。 「坊や、人生は旅のようなものだ」老人が突然言った。',
        '風が草を揺らし、池の水が小さな波を立てた。どこかで鳥が鳴いていた。\n\n「坊や、人生は旅のようなものだ」老人が突然言った。'
    )

    content = content.replace(
        '「私たちは皆、何かを探している。ある人は家族を、ある人は家を、ある人は自分自身を探している。お前は父親を探している。それは立派な目的だ」 「でも、見つけられるでしょうか?」私は尋ねた。 「見つかるかどうかは分からない」老人が答えた。',
        '「私たちは皆、何かを探している。ある人は家族を、ある人は家を、ある人は自分自身を探している。お前は父親を探している。それは立派な目的だ」\n\n「でも、見つけられるでしょうか?」私は尋ねた。\n\n「見つかるかどうかは分からない」老人が答えた。'
    )

    content = content.replace(
        '「だが、探す過程で、お前は多くのことを学ぶだろう。新しい人々に会い、新しい場所を見て、新しい自分を発見する。それこそが旅の真の価値なんだ」 日が沈み始めた。',
        '「だが、探す過程で、お前は多くのことを学ぶだろう。新しい人々に会い、新しい場所を見て、新しい自分を発見する。それこそが旅の真の価値なんだ」\n\n日が沈み始めた。'
    )

    # SECTION 5: Receiving the snake
    content = content.replace(
        '老人は立ち上がり、草の中を歩き始めた。彼は何かを探しているようだった。 「ここだ」老人が言い、草の中から小さな蛇を取り上げた。',
        '老人は立ち上がり、草の中を歩き始めた。彼は何かを探しているようだった。\n\n「ここだ」老人が言い、草の中から小さな蛇を取り上げた。'
    )

    content = content.replace(
        '「これは無毒の蛇だ。お前にあげよう」 「え?」私は驚いた。 「お前の旅の友として持っていきなさい」老人が言った。',
        '「これは無毒の蛇だ。お前にあげよう」\n\n「え?」私は驚いた。\n\n「お前の旅の友として持っていきなさい」老人が言った。'
    )

    content = content.replace(
        '「この蛇は幸運をもたらすと言われている。それに、蛇は道を知っている。彼らは本能的に正しい方向を感じ取ることができるんだ」\n\n私は小さな蛇を受け取った。',
        '「この蛇は幸運をもたらすと言われている。それに、蛇は道を知っている。彼らは本能的に正しい方向を感じ取ることができるんだ」\n\n私は小さな蛇を受け取った。'
    )

    content = content.replace(
        'それは私の手の中で静かに丸まっていた。 「ありがとうございます」私は言った。 「さあ、市場に戻ろう」老人が言った。',
        'それは私の手の中で静かに丸まっていた。\n\n「ありがとうございます」私は言った。\n\n「さあ、市場に戻ろう」老人が言った。'
    )

    # SECTION 6: Returning and reflection
    content = content.replace(
        '「トゥ・ベオおばさんが心配しているだろう」 私たちは夕暮れの中を市場に向かって歩いた。',
        '「トゥ・ベオおばさんが心配しているだろう」\n\n私たちは夕暮れの中を市場に向かって歩いた。'
    )

    content = content.replace(
        'その日、私は蛇売りの老人から、旅についての大切な教訓を学んだ。旅は目的地に着くことだけではない。旅そのものが、私たちを成長させるのだ。 その夜、私は小さな蛇を籠に入れ、',
        'その日、私は蛇売りの老人から、旅についての大切な教訓を学んだ。旅は目的地に着くことだけではない。旅そのものが、私たちを成長させるのだ。\n\nその夜、私は小さな蛇を籠に入れ、'
    )

    content = content.replace(
        '自分の寝床の近くに置いた。蛇は静かに眠っていた。私もまた、明日への期待を胸に、深い眠りについた。',
        '自分の寝床の近くに置いた。蛇は静かに眠っていた。\n\n私もまた、明日への期待を胸に、深い眠りについた。'
    )

    return content

def main():
    """Align Japanese chapter 3 paragraph structure"""
    ja_filepath = Path(__file__).parent / 'chapters' / 'json' / 'chapter-ja-3.json'

    print(f"Reading {ja_filepath}...")
    with open(ja_filepath, 'r', encoding='utf-8') as f:
        data = json.load(f)

    original_content = data['content']
    original_count = len([p for p in original_content.split('\n\n') if p.strip()])

    print("Aligning paragraph structure...")
    aligned_content = align_japanese_paragraphs(original_content)
    new_count = len([p for p in aligned_content.split('\n\n') if p.strip()])

    if original_content != aligned_content:
        data['content'] = aligned_content
        print(f"Writing aligned content...")
        with open(ja_filepath, 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)

        print(f"\n✓ Japanese Chapter 3 aligned")
        print(f"  Paragraphs: {original_count} → {new_count} (+{new_count - original_count})")
    else:
        print("- No changes needed")

if __name__ == '__main__':
    main()
