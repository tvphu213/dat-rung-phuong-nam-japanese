<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japanese Prefetch Verification Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-card {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2d5016;
        }
        h2 {
            color: #4a7c2c;
            margin-top: 0;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: bold;
            margin-left: 10px;
        }
        .pass {
            background: #4caf50;
            color: white;
        }
        .fail {
            background: #f44336;
            color: white;
        }
        .pending {
            background: #ff9800;
            color: white;
        }
        code {
            background: #e8e8e8;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
            border-left: 4px solid #2d5016;
        }
        button {
            background: #2d5016;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #4a7c2c;
        }
        button.secondary {
            background: #666;
        }
        button.secondary:hover {
            background: #888;
        }
        .instruction {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #2196f3;
        }
        .warning {
            background: #fff3e0;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #ff9800;
        }
        .test-step {
            margin: 15px 0;
            padding: 15px;
            background: #fafafa;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .test-step h3 {
            margin-top: 0;
            color: #2d5016;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #f0f0f0;
            font-weight: bold;
        }
        tr:hover {
            background: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>üáØüáµ Japanese Prefetch Verification Test</h1>

    <div class="test-card">
        <h2>Test Objective</h2>
        <p>Verify that the prefetch functionality correctly handles Japanese chapter files with the <code>_ja.txt</code> suffix.</p>
        <div class="warning">
            <strong>‚ö†Ô∏è Prerequisites:</strong>
            <ul>
                <li>Japanese chapter files must exist in <code>./chapters/ja/</code> directory</li>
                <li>Files should be named: <code>chapter1_ja.txt</code>, <code>chapter2_ja.txt</code>, etc.</li>
                <li>DevTools Network tab should be open</li>
            </ul>
        </div>
    </div>

    <div class="test-card">
        <h2>Test Scenarios</h2>

        <div class="test-step">
            <h3>Scenario 1: Japanese Chapter 1</h3>
            <div class="instruction">
                <strong>Steps:</strong>
                <ol>
                    <li>Click "Open Japanese Chapter 1" button below</li>
                    <li>Wait for page to load</li>
                    <li>Open DevTools Network tab (F12)</li>
                    <li>Filter by "chapter2_ja"</li>
                    <li>Verify prefetch request appears</li>
                </ol>
            </div>
            <button onclick="openJapaneseChapter(1)">üìñ Open Japanese Chapter 1</button>
            <div class="test-result">
                <strong>Expected:</strong> Prefetch link for <code>./chapters/ja/chapter2_ja.txt</code>
                <br>
                <input type="checkbox" id="test1">
                <label for="test1">Verified: chapter2_ja.txt prefetch appears</label>
            </div>
        </div>

        <div class="test-step">
            <h3>Scenario 2: Japanese Chapter 10</h3>
            <div class="instruction">
                <strong>Steps:</strong>
                <ol>
                    <li>Click "Open Japanese Chapter 10" button below</li>
                    <li>Check Network tab for chapter11_ja.txt prefetch</li>
                </ol>
            </div>
            <button onclick="openJapaneseChapter(10)">üìñ Open Japanese Chapter 10</button>
            <div class="test-result">
                <strong>Expected:</strong> Prefetch link for <code>./chapters/ja/chapter11_ja.txt</code>
                <br>
                <input type="checkbox" id="test2">
                <label for="test2">Verified: chapter11_ja.txt prefetch appears</label>
            </div>
        </div>

        <div class="test-step">
            <h3>Scenario 3: Japanese Chapter 19</h3>
            <div class="instruction">
                <strong>Steps:</strong>
                <ol>
                    <li>Click "Open Japanese Chapter 19" button below</li>
                    <li>Check Network tab for chapter20_ja.txt prefetch</li>
                </ol>
            </div>
            <button onclick="openJapaneseChapter(19)">üìñ Open Japanese Chapter 19</button>
            <div class="test-result">
                <strong>Expected:</strong> Prefetch link for <code>./chapters/ja/chapter20_ja.txt</code>
                <br>
                <input type="checkbox" id="test3">
                <label for="test3">Verified: chapter20_ja.txt prefetch appears</label>
            </div>
        </div>

        <div class="test-step">
            <h3>Scenario 4: Japanese Chapter 20 (Edge Case)</h3>
            <div class="instruction">
                <strong>Steps:</strong>
                <ol>
                    <li>Click "Open Japanese Chapter 20" button below</li>
                    <li>Check Network tab - should NOT see chapter21_ja.txt</li>
                    <li>Inspect document.head - should NOT have prefetch link</li>
                </ol>
            </div>
            <button onclick="openJapaneseChapter(20)">üìñ Open Japanese Chapter 20</button>
            <div class="test-result">
                <strong>Expected:</strong> NO prefetch link (last chapter)
                <br>
                <input type="checkbox" id="test4">
                <label for="test4">Verified: No chapter21_ja.txt prefetch</label>
            </div>
        </div>

        <div class="test-step">
            <h3>Scenario 5: Tab Switching</h3>
            <div class="instruction">
                <strong>Steps:</strong>
                <ol>
                    <li>Click "Open Vietnamese Chapter 5" button</li>
                    <li>Verify prefetch for <code>chapter6.txt</code> (Vietnamese)</li>
                    <li>Switch to Japanese tab (Êó•Êú¨Ë™û)</li>
                    <li>Verify prefetch updates to <code>chapter6_ja.txt</code> (Japanese)</li>
                </ol>
            </div>
            <button onclick="openVietnameseChapter(5)">üìñ Open Vietnamese Chapter 5</button>
            <div class="test-result">
                <strong>Expected:</strong> Prefetch changes from <code>chapter6.txt</code> to <code>chapter6_ja.txt</code> when switching tabs
                <br>
                <input type="checkbox" id="test5">
                <label for="test5">Verified: Prefetch updates correctly on tab switch</label>
            </div>
        </div>
    </div>

    <div class="test-card">
        <h2>Prefetch File Path Verification</h2>
        <p>Expected file paths for Japanese chapters:</p>
        <table>
            <thead>
                <tr>
                    <th>Current Chapter</th>
                    <th>Prefetch File Path</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Chapter 1 (Japanese)</td>
                    <td><code>./chapters/ja/chapter2_ja.txt</code></td>
                    <td><input type="checkbox" id="path1"></td>
                </tr>
                <tr>
                    <td>Chapter 5 (Japanese)</td>
                    <td><code>./chapters/ja/chapter6_ja.txt</code></td>
                    <td><input type="checkbox" id="path2"></td>
                </tr>
                <tr>
                    <td>Chapter 10 (Japanese)</td>
                    <td><code>./chapters/ja/chapter11_ja.txt</code></td>
                    <td><input type="checkbox" id="path3"></td>
                </tr>
                <tr>
                    <td>Chapter 19 (Japanese)</td>
                    <td><code>./chapters/ja/chapter20_ja.txt</code></td>
                    <td><input type="checkbox" id="path4"></td>
                </tr>
                <tr>
                    <td>Chapter 20 (Japanese)</td>
                    <td><em>No prefetch (last chapter)</em></td>
                    <td><input type="checkbox" id="path5"></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="test-card">
        <h2>DevTools Console Inspection</h2>
        <div class="instruction">
            <p>Run these commands in the DevTools Console to inspect prefetch elements:</p>
            <ol>
                <li>
                    <strong>Check current prefetch link:</strong><br>
                    <code>document.querySelector('link[rel="prefetch"][data-chapter-prefetch]')</code>
                </li>
                <li>
                    <strong>Get prefetch href:</strong><br>
                    <code>document.querySelector('link[rel="prefetch"][data-chapter-prefetch]')?.href</code>
                </li>
                <li>
                    <strong>Get prefetch chapter number:</strong><br>
                    <code>document.querySelector('link[rel="prefetch"][data-chapter-prefetch]')?.dataset.chapterPrefetch</code>
                </li>
                <li>
                    <strong>Count prefetch links (should be 0 or 1):</strong><br>
                    <code>document.querySelectorAll('link[rel="prefetch"][data-chapter-prefetch]').length</code>
                </li>
            </ol>
        </div>
    </div>

    <div class="test-card">
        <h2>Test Summary</h2>
        <button onclick="checkAllTests()">‚úÖ Calculate Test Pass Rate</button>
        <button class="secondary" onclick="resetAllTests()">üîÑ Reset All Tests</button>
        <div id="summary" style="margin-top: 15px; font-size: 18px; font-weight: bold;"></div>
    </div>

    <script>
        function openJapaneseChapter(chapterNum) {
            const url = `./index.html#/chapter/${chapterNum}`;
            const win = window.open(url, '_blank');

            setTimeout(() => {
                alert(`Japanese Chapter ${chapterNum} opened in new tab!\n\n` +
                      `Instructions:\n` +
                      `1. Switch to Japanese tab (Êó•Êú¨Ë™û)\n` +
                      `2. Open DevTools (F12)\n` +
                      `3. Go to Network tab\n` +
                      `4. Look for chapter${chapterNum + 1}_ja.txt prefetch\n\n` +
                      `Console command:\n` +
                      `document.querySelector('link[rel="prefetch"]')?.href`);
            }, 500);
        }

        function openVietnameseChapter(chapterNum) {
            const url = `./index.html#/chapter/${chapterNum}`;
            window.open(url, '_blank');

            setTimeout(() => {
                alert(`Vietnamese Chapter ${chapterNum} opened!\n\n` +
                      `Instructions:\n` +
                      `1. Keep Vietnamese tab active (Ti·∫øng Vi·ªát)\n` +
                      `2. Check for chapter${chapterNum + 1}.txt prefetch\n` +
                      `3. Then switch to Japanese tab (Êó•Êú¨Ë™û)\n` +
                      `4. Verify prefetch changes to chapter${chapterNum + 1}_ja.txt`);
            }, 500);
        }

        function checkAllTests() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            const total = checkboxes.length;
            let passed = 0;

            checkboxes.forEach(cb => {
                if (cb.checked) passed++;
            });

            const percentage = Math.round((passed / total) * 100);
            const summaryDiv = document.getElementById('summary');

            if (percentage === 100) {
                summaryDiv.innerHTML = `<span style="color: #4caf50;">‚úÖ All tests passed! (${passed}/${total})</span>`;
            } else if (percentage >= 80) {
                summaryDiv.innerHTML = `<span style="color: #ff9800;">‚ö†Ô∏è Mostly passed: ${passed}/${total} (${percentage}%)</span>`;
            } else {
                summaryDiv.innerHTML = `<span style="color: #f44336;">‚ùå Some tests failed: ${passed}/${total} (${percentage}%)</span>`;
            }
        }

        function resetAllTests() {
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
            document.getElementById('summary').innerHTML = '';
        }
    </script>
</body>
</html>
